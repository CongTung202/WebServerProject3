<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${nctPageTitle}">Chi tiết đơn hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/nct-user-style.css}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
</head>
<body>
<div th:replace="~{fragments/nct-header :: header}"></div>
<div th:replace="~{fragments/nct-sidebar :: sidebar(activePage='orders')}"></div>

<main class="main-content">
    <div class="page-header flex justify-between items-center">
        <h1>Chi tiết đơn hàng #<span th:text="${nctOrder.nctOrderId}"></span></h1>
        <a th:href="@{/orders}" class="text-sm text-gray-600 hover:text-red-500 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>Quay lại danh sách
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Order Details -->
        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-bold mb-4 border-b pb-3">Sản phẩm trong đơn hàng</h2>
            <div th:each="item : ${nctOrder.nctOrderItems}" class="flex items-center py-4 border-b last:border-b-0">
                <img th:src="@{${item.nctProduct.nctImageUrl}}" alt="Product Image" class="w-20 h-20 object-cover rounded-md mr-4">
                <div class="flex-grow">
                    <p class="font-semibold text-gray-800" th:text="${item.nctProduct.nctProductName}"></p>
                    <p class="text-sm text-gray-500">Số lượng: <span th:text="${item.nctQuantity}"></span></p>
                </div>
                <div class="text-right">
                    <p class="font-semibold text-gray-800" th:text="|₫${#numbers.formatDecimal(item.nctPrice, 0, 'COMMA', 0, 'POINT')}|"></p>
                    <p class="text-sm text-gray-500">Thành tiền: <span class="font-medium" th:text="|₫${#numbers.formatDecimal(item.nctPrice.multiply(new java.math.BigDecimal(item.nctQuantity)), 0, 'COMMA', 0, 'POINT')}|"></span></p>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="bg-white p-6 rounded-lg shadow-md h-fit">
            <h2 class="text-xl font-bold mb-4 border-b pb-3">Thông tin đơn hàng</h2>
            <div class="space-y-3 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-600">Mã đơn hàng:</span>
                    <span class="font-semibold text-gray-800" th:text="'#' + ${nctOrder.nctOrderId}"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Ngày đặt:</span>
                    <span class="font-semibold text-gray-800" th:text="${#temporals.format(nctOrder.nctCreatedAt, 'dd/MM/yyyy HH:mm')}"></span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Trạng thái:</span>
                    <span class="text-xs font-semibold py-1 px-3 rounded-full uppercase"
                          th:text="${nctOrder.getNctStatusDisplayName()}"
                          th:classappend="${nctOrder.nctStatus.name() == 'PENDING' ? 'bg-yellow-100 text-yellow-800' :
                                           (nctOrder.nctStatus.name() == 'DELIVERED' ? 'bg-green-100 text-green-800' :
                                           (nctOrder.nctStatus.name() == 'CANCELLED' ? 'bg-red-100 text-red-800' :
                                           (nctOrder.nctStatus.name() == 'SHIPPING' ? 'bg-blue-100 text-blue-800' :
                                           (nctOrder.nctStatus.name() == 'CONFIRMED' ? 'bg-indigo-100 text-indigo-800' : 'bg-gray-100 text-gray-800'))))}">
                    </span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Thanh toán:</span>
                    <span class="font-semibold text-gray-800" th:text="${nctOrder.getNctPaymentMethodDisplayName()}"></span>
                </div>
            </div>

            <hr class="my-4">

            <h3 class="text-lg font-bold mb-3">Địa chỉ giao hàng</h3>
            <div class="text-sm text-gray-700 space-y-1">
                <p th:text="${nctOrder.nctUser.nctFullName}"></p>
                <p th:text="${nctOrder.nctShippingAddress}"></p>
                <p th:text="${nctOrder.nctPhone}"></p>
            </div>

            <hr class="my-4">

            <div class="flex justify-between items-center text-lg">
                <span class="font-semibold">Tổng cộng:</span>
                <span class="text-red-500 font-bold" th:text="|₫${#numbers.formatDecimal(nctOrder.nctTotalAmount, 0, 'COMMA', 0, 'POINT')}|"></span>
            </div>
            <div class="mt-6 flex flex-col gap-3">

                <div th:if="${nctOrder.nctStatus.name() == 'CANCELLED' || nctOrder.nctStatus.name() == 'DELIVERED'}">
                    <form th:action="@{/orders/buy-again/{id}(id=${nctOrder.nctOrderId})}" method="post">
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-200 shadow-md flex items-center justify-center">
                            <i class="fas fa-shopping-cart mr-2"></i> Mua lại đơn hàng này
                        </button>
                    </form>
                </div>

                <div th:if="${nctOrder.nctStatus.name() == 'PENDING' || nctOrder.nctStatus.name() == 'CONFIRMED'}">
                    <form th:action="@{/orders/cancel/{id}(id=${nctOrder.nctOrderId})}" method="post"
                          onsubmit="return confirm('Bạn có chắc chắn muốn hủy đơn hàng này?');">
                        <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition duration-200">
                            <i class="fas fa-times mr-2"></i> Hủy đơn hàng
                        </button>
                    </form>
                </div>

            </div>        </div>
    </div>
</main>
<div th:replace="~{fragments/nct-chat-model :: nct-chat-model(pageContext='orders', contextProduct=null)}"></div>
<div th:replace="~{fragments/nct-footer :: footer}"></div>

</body>
</html>